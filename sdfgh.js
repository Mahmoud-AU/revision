//#region SURAH LIST
let surah1 = new Surah("Al-Fatihah", 1, [1], null);
let surah2_1 = new Surah("Al-Baqarah", 21, [1], "Juz 1");
let surah2_2 = new Surah("Al-Baqarah", 20, [2], "Juz 2");
let surah2_3 = new Surah("Al-Baqarah", 8, [3], "Juz 3");
let surah3 = new Surah("Ali Imran", 27, [3, 4], null);
let surah4 = new Surah("An-Nisa'", 30, [4, 5, 6], null);
let surah5 = new Surah("Al-Ma'idah", 23, [6, 7], null);
let surah6 = new Surah("Al-An'am", 23, [7, 8], null);
let surah7 = new Surah("Al-A'raf", 26, [8, 9], null);
let surah8 = new Surah("Al-Anfal", 10, [9, 10], null);
let surah9 = new Surah("At-Tawbah", 21, [10, 11], null);
let surah10 = new Surah("Yunus", 14, [11], null);
let surah11 = new Surah("Hud", 15, [11, 12], null);
let surah12 = new Surah("Yusuf", 14, [12, 13], null);
let surah13 = new Surah("Ar-Ra'd", 6, [13], null);
let surah14 = new Surah("Ibraheem", 7, [13], null);
let surah15 = new Surah("Al-Hijr", 6, [14], null);
let surah16 = new Surah("An-Nahl", 15, [14], null);
let surah17 = new Surah("Al-Isra'", 12, [15], null);
let surah18 = new Surah("Al-Kahf", 12, [15, 16], null);
let surah19 = new Surah("Maryam", 8, [16], null);
let surah20 = new Surah("Ta-Ha", 10, [16], null);
let surah21 = new Surah("Al-Anbiya'", 10, [17], null);
let surah22 = new Surah("Al-Hajj", 10, [17], null);
let surah23 = new Surah("Al-Mu'minoon", 8, [18], null);
let surah24 = new Surah("An-Noor", 10, [18], null);
let surah25 = new Surah("Al-Furqan", 8, [18, 19], null);
let surah26 = new Surah("Ash-Shu'ara'", 10, [19], null);
let surah27 = new Surah("An-Naml", 9, [19, 20], null);
let surah28 = new Surah("Al-Qasas", 12, [20], null);
let surah29 = new Surah("Al-Ankabut", 9, [20, 21], null);
let surah30 = new Surah("Ar-Rum", 8, [21], null);
let surah31 = new Surah("Luqman", 4, [21], null);
let surah32 = new Surah("As-Sajdah", 3, [21], null);
let surah33 = new Surah("Al-Ahzab", 10, [21, 22], null);
let surah34 = new Surah("As-Saba'", 7, [22], null);
let surah35 = new Surah("Fatir", 6, [22], null);
let surah36 = new Surah("Ya-Seen", 6, [22, 23], null);
let surah37 = new Surah("As-Saffat", 7, [23], null);
let surah38 = new Surah("Saad", 5, [23], null);
let surah39 = new Surah("Az-Zumar", 9, [23, 24], null);
let surah40 = new Surah("Ghafir", 10, [24], null);
let surah41 = new Surah("Fussilat", 6, [24, 25], null);
let surah42 = new Surah("Ash-Shura", 7, [25], null);
let surah43 = new Surah("Az-Zukhruf", 7, [25], null);
let surah44 = new Surah("Ad-Dukhan", 3, [25], null);
let surah45 = new Surah("Al-Jathiyah", 4, [25, 26], null);
let surah46 = new Surah("Al-Ahqaf", 5, [26], null);
let surah47 = new Surah("Muhammad", 4, [26], null);
let surah48 = new Surah("Al-Fath", 5, [26], null);
let surah49 = new Surah("Al-Hujurat", 3, [26], null);
let surah50 = new Surah("Qaaf", 3, [26], null);
let surah51 = new Surah("Adh-Dhariyaat", 3, [26, 27], null);
let surah52 = new Surah("At-Tur", 3, [27], null);
let surah53 = new Surah("An-Najm", 3, [27], null);
let surah54 = new Surah("Al-Qamar", 3, [27], null);
let surah55 = new Surah("Ar-Rahman", 3, [27], null);
let surah56 = new Surah("Al-Wa'qiah", 3, [27], null);
let surah57 = new Surah("Al-Hadeed", 4, [27], null);
let surah58 = new Surah("Al-Mujadilah", 3, [28], null);
let surah59 = new Surah("Al-Hashr", 4, [28], null);
let surah60 = new Surah("Al-Mumtahanah", 3, [28], null);
let surah61 = new Surah("As-Saff", 2, [28], null);
let surah62 = new Surah("Al-Jumu'ah", 2, [28], null);
let surah63 = new Surah("Al-Munafiqoon", 2, [28], null);
let surah64 = new Surah("At-Taghabun", 2, [28], null);
let surah65 = new Surah("At-Talaq", 2, [28], null);
let surah66 = new Surah("At-Tahreem", 2, [28], null);
let surah67 = new Surah("Al-Mulk", 3, [29], null);
let surah68 = new Surah("Al-Qalam", 3, [29], null);
let surah69 = new Surah("Al-Haqqah", 3, [29], null);
let surah70 = new Surah("Al-Ma'arij", 3, [29], null);
let surah71 = new Surah("Nuh", 2, [29], null);
let surah72 = new Surah("Al-Jinn", 2, [29], null);
let surah73 = new Surah("Al-Muzzammil", 2, [29], null);
let surah74 = new Surah("Al-Muddaththir", 3, [29], null);
let surah75 = new Surah("Al-Qiyamah", 2, [29], null);
let surah76 = new Surah("Al-Insaan", 3, [29], null);
let surah77 = new Surah("Al-Mursalaat", 2, [29], null);
let surah78 = new Surah("An-Naba'", 2, [30], null);
let surah79 = new Surah("An-Nazi'at", 2, [30], null);
let surah80 = new Surah("'Abasa", 1, [30], null);
let surah81 = new Surah("At-Takweer", 1, [30], null);
let surah82 = new Surah("Al-Infitar", 1, [30], null);
let surah83 = new Surah("Al-Mutaffifeen", 2, [30], null);
let surah84 = new Surah("Al-Inshiqaq", 1, [30], null);
let surah85 = new Surah("At-Tariq", 1, [30], null);
let surah86 = new Surah("Al-Burooj", 1, [30], null);
let surah87 = new Surah("Al-A'la", 1, [30], null);
let surah88 = new Surah("Al-Ghashiyah", 1, [30], null);
let surah89 = new Surah("Al-Fajr", 2, [30], null);
let surah90 = new Surah("Al-Balad", 1, [30], null);
let surah91 = new Surah("Ash-Shams", 1, [30], null);
let surah92 = new Surah("Al-Layl", 1, [30], null);
let surah93 = new Surah("Ad-Duha", 1, [30], null);
let surah94 = new Surah("Ash-Sharh", 1, [30], null);
let surah95 = new Surah("At-Tin", 1, [30], null);
let surah96 = new Surah("Al-'Alaq'", 1, [30], null);
let surah97 = new Surah("Al-Qadr", 1, [30], null);
let surah98 = new Surah("Al-Bayyinah", 1, [30], null);
let surah99 = new Surah("Al-Zalzalah", 1, [30], null);
let surah100 = new Surah("Al'Adiyaat", 1, [30], null);
let surah101 = new Surah("Al-Qari'ah", 1, [30], null);
let surah102 = new Surah("At-Takathur", 1, [30], null);
let surah103 = new Surah("Al-'Asr", 1, [30], null);
let surah104 = new Surah("Al-Humazah", 1, [30], null);
let surah105 = new Surah("Al-Fil", 1, [30], null);
let surah106 = new Surah("Quraysh", 1, [30], null);
let surah107 = new Surah("Al-Ma'oon", 1, [30], null);
let surah108 = new Surah("Al-Kawthar", 1, [30], null);
let surah109 = new Surah("Al-Kafiroon", 1, [30], null);
let surah110 = new Surah("An-Nasr", 1, [30], null);
let surah111 = new Surah("Al-Masad", 1, [30], null);
let surah112 = new Surah("Al-Ikhlaas", 1, [30], null);
let surah113 = new Surah("Al-Falaq", 1, [30], null);
let surah114 = new Surah("An-Naas", 1, [30], null);
//#endregion

let surahs = [surah1, surah2_1, surah2_2, surah2_3, surah3, surah4, surah5, surah6, surah7, surah8, surah9, surah10,
    surah11, surah12, surah13, surah14, surah15, surah16, surah17, surah18, surah19, surah20,
    surah21, surah22, surah23, surah24, surah25, surah26, surah27, surah28, surah29, surah30,
    surah31, surah32, surah33, surah34, surah35, surah36, surah37, surah38, surah39, surah40,
    surah41, surah42, surah43, surah44, surah45, surah46, surah47, surah48, surah49, surah50,
    surah51, surah52, surah53, surah54, surah55, surah56, surah57, surah58, surah69, surah60,
    surah61, surah62, surah63, surah64, surah65, surah66, surah67, surah68, surah69, surah70,
    surah71, surah72, surah73, surah74, surah75, surah76, surah77, surah78, surah79, surah80,
    surah81, surah82, surah83, surah84, surah85, surah86, surah87, surah88, surah89, surah90,
    surah91, surah92, surah93, surah94, surah95, surah96, surah97, surah98, surah99, surah100,
    surah101, surah102, surah103, surah104, surah105, surah106, surah107, surah108, surah109,
    surah110, surah111, surah112, surah113, surah114];

let allSection = document.getElementById("all");
let currentlyRevising = [];
let currentSection = allSection;

let emojisParent = document.querySelector(".selection-area");
let selectedEmojisParent = document.querySelector(".selected-area");

let memorisedArray = JSON.parse(localStorage.getItem("array")) || [];

let boxTemplates = document.querySelectorAll('.revisionTemplate');
let firstFiveSet = false;

let progress = document.getElementById("progress");
let goal = document.getElementById("goal");
let progressBarBG = document.getElementById("progressBarBG");
let progressBar = document.getElementById("progressBar");
let goalDropdown = document.querySelector(".goals");

let progressAmount = JSON.parse(localStorage.getItem("progress")) || 0;
let goalAmount = JSON.parse(localStorage.getItem("goal")) || 10;

let selectionContent = document.getElementById("section-navigation-content");

function Surah(name, points, sectionNumber, juz, id) {
    this.name = name;
    this.points = points;
    this.sectionNumber = sectionNumber;
    this.juz = juz;
    this.id = id;
    this.createEmoji = function() {
        let emojiBtn = document.createElement("button");
        emojiBtn.classList.add("emoji-box");

        var h1Element = document.createElement("h1");
        var h1Text = document.createTextNode(this.name);
        h1Element.appendChild(h1Text);
        emojiBtn.appendChild(h1Element);

        if (this.juz !== null) {
            var jElement = document.createElement("p");
            var jText = document.createTextNode(this.juz);
            jElement.appendChild(jText);
            emojiBtn.appendChild(jElement);
        }

        var pElement = document.createElement("p");
        var pText = document.createTextNode(this.points);
        pElement.appendChild(pText);
        emojiBtn.appendChild(pElement);

        emojisParent.appendChild(emojiBtn);
        emojiBtn.onclick = () => memoriseCheck(emojiBtn, this);
        emojiBtn.setAttribute("data-emoji", JSON.stringify(this));
        for (let dd = 0; dd < memorisedArray.length; dd++) {
            if (memorisedArray[dd].id === this.id) {
                memorisedFunction(emojiBtn);
            }
        }
    }
    function memoriseCheck(el, obj) {
        if (memorisedArray.length > 0) {
            for (let mc = 0; mc < memorisedArray.length; mc++) {
                if (memorisedArray[mc].id !== obj.id && mc === memorisedArray.length - 1) {
                    console.log("ADDED");
                    createInstance(obj);
                    memorisedFunction(el);
                    memorisedArray.push(obj);
                    localStorage.setItem("array", JSON.stringify(memorisedArray));
                    break;
                }
                else if (memorisedArray[mc].id === obj.id) {
                    deleteInstance(obj);
                    memorisedArray.splice(mc, 1);
                    el.style.backgroundColor = "white";
                    el.style.boxShadow = "0px 0px 3px white";
                    for (let ffs = 0; ffs < boxTemplates.length; ffs++) {
                        if (boxTemplates[ffs].children.length === 0) {
                            firstFiveSet = false;
                            if (memorisedArray.length > 4) {
                                updatePositioning(el, obj);
                            }
                            break;
                        }
                    }
                    localStorage.setItem("array", JSON.stringify(memorisedArray));
                    break;
                }
            }
        }
        else {
            createInstance(obj);
            memorisedArray.push(obj);
            memorisedFunction(el);
            localStorage.setItem("array", JSON.stringify(memorisedArray));
        }
    }
    function createInstance(obj) {
        var instanceBtn = document.createElement("button");
        instanceBtn.classList.add("instance-box");

        var h1Element = document.createElement("h1");
        var h1Text = document.createTextNode(obj.name);
        h1Element.appendChild(h1Text);
        instanceBtn.appendChild(h1Element);
        
        if (obj.juz !== null) {
            var jElement = document.createElement("p");
            var jText = document.createTextNode(obj.juz);
            jElement.appendChild(jText);
            instanceBtn.appendChild(jElement);
        }

        var pElement = document.createElement("p");
        var pText = document.createTextNode(obj.points);
        pElement.appendChild(pText);
        instanceBtn.appendChild(pElement);

        if (!firstFiveSet) firstFive(instanceBtn);
        else selectedEmojisParent.appendChild(instanceBtn);
        instanceBtn.setAttribute("data-emoji", JSON.stringify(obj));
        instanceBtn.onclick = () => reviseCheck(instanceBtn, obj);
    }
    function deleteInstance(obj) {
        var executeDelete = false;
        for (let bt = 0; bt < boxTemplates.length; bt++) {
            if (boxTemplates[bt].firstElementChild !== null) {
                if (obj.name === boxTemplates[bt].firstElementChild.firstElementChild.innerHTML) {
                    boxTemplates[bt].firstElementChild.remove();
                    break;
                }
                else executeDelete = true;
            }
        }
        if (executeDelete) {
            for (let totd = 0; totd < selectedEmojisParent.children.length; totd++) {
                if (obj.name === selectedEmojisParent.children[totd].firstElementChild.innerHTML) {
                    selectedEmojisParent.children[totd].remove();
                    break;
                }
            }
        }
    }
}

function reviseCheck(el, obj) {
    addToProgress(obj);
    setTimeout(function() { updatePositioning(el, obj); }, 50);
}
function updatePositioning(el, obj) {
    var newParent = el.parentNode;
    selectedEmojisParent.appendChild(el);
    var firstChild = selectedEmojisParent.firstElementChild;
    newParent.appendChild(firstChild);
    firstChild.style.backgroundColor = "#00FF74";
    firstChild.style.boxShadow = "0px 0px 5px #00FF74";
    if (firstFiveSet) {
        for (let index = 0; index < memorisedArray.length; index++) {
            if (memorisedArray[index].id === obj.id) {
                memorisedArray[index] = memorisedArray[5];
                memorisedArray.splice(5, 1)
                memorisedArray.push(obj);
                break;
            }
        }
    }
    localStorage.setItem("array", JSON.stringify(memorisedArray));
    setTimeout(function ssd() {
        firstChild.style.backgroundColor = "white";
        firstChild.style.boxShadow = "none";
    }, 50);
}

function createInstance(obj) {
    var instanceBtn = document.createElement("button");
    instanceBtn.classList.add("instance-box");
    var h1Element = document.createElement("h1");
    var h1Text = document.createTextNode(obj.name);
    var pElement = document.createElement("p");
    var pText = document.createTextNode(obj.points);
    h1Element.appendChild(h1Text);
    pElement.appendChild(pText);
    instanceBtn.appendChild(h1Element);
    instanceBtn.appendChild(pElement);
    instanceBtn.style.display = "inline";
    if (!firstFiveSet) firstFive(instanceBtn);
    else selectedEmojisParent.appendChild(instanceBtn);
    instanceBtn.setAttribute("data-emoji", JSON.stringify(obj));
    console.log(JSON.parse(instanceBtn.getAttribute("data-emoji")));
    instanceBtn.onclick = () => reviseCheck(instanceBtn, obj);
}

surahs.forEach(element => {
    element.createEmoji();
});

memorisedArray.forEach(element => {
    if (boxTemplates[4].children.length !== 0) firstFiveSet = true;
    createInstance(element);
});

function memorisedFunction(el) {
    el.style.backgroundColor = "#00FF74";
    el.style.boxShadow = "0px 0px 3px #00FF74";
}

function firstFive(rb) {
    for (let f = 0; f < boxTemplates.length; f++) {
        if (boxTemplates[f].children.length === 0) {
            boxTemplates[f].appendChild(rb);
            if (boxTemplates[4].children.length !== 0) firstFiveSet = true;
            break;
        }
    }
}

function reset() {
    localStorage.clear();
    window.location.reload();
}

function resetProgress() {
    localStorage.removeItem("progress");
    window.location.reload();
}

//#region SECTION TOGGLES
function makeSelected(hj) {
    currentSection.classList.add("section-button-hover");
    currentSection.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
    currentSection = hj;
    currentSection.classList.remove("section-button-hover");
    currentSection.style.backgroundColor = "green";
}

function toggleDiv(e, t) {
    for (let p = 0; p < emojisParent.children.length; p++) {
        var kk = emojisParent.children[p];
        if (JSON.parse(kk.getAttribute("data-emoji")).sectionNumber.includes(parseInt(e))) {
            kk.style.display = "flex";
        }
        else kk.style.display = "none";
    }
    makeSelected(t);
}

function toggleAll(t) {
    for (let p = 0; p < emojisParent.children.length; p++) {
        emojisParent.children[p].style.display = "flex";
    }
    makeSelected(t);
}

toggleAll(all);
//#endregion

function addToProgress(e) {
    progressAmount += e.points;
    loadProgress();
}

function loadProgress() {
    progress.innerHTML = progressAmount.toString();
    goal.innerHTML = goalAmount.toString();
    var dde = progressBarBG.clientWidth;
    var dd = (progressAmount/goalAmount) * dde;
    var dh = 290;
    if (progressAmount >= goalAmount) {
        progressBar.style.width = dh.toString() + "px";
        progressBar.style.backgroundColor = "#00FF74";
        progressBar.style.boxShadow = "0 0 5px #00FF74";
    }
    else {
        progressBar.style.width = dd.toString() + "px";
        progressBar.style.backgroundColor = "#ffd100";
        progressBar.style.boxShadow = "none";
    }
    for (let fg = 0; fg < goalDropdown.children.length; fg++) {
        if (goalDropdown.children[fg].value === goalAmount) {
            goalDropdown.children[fg].style.backgroundColor = "orange";
        }
        else {
            goalDropdown.children[fg].style.backgroundColor = "white";
        }
    }
    localStorage.setItem("progress", JSON.stringify(progressAmount));
}

loadProgress();

function changeGoalDropdown() {
    if (goalDropdown.style.display === "flex") goalDropdown.style.display = "none";
    else goalDropdown.style.display = "flex";
}

function changeGoal(e, f) {
    goalAmount = e;
    localStorage.setItem("goal", JSON.stringify(goalAmount));
    changeGoalDropdown();
    loadProgress();
}

function openSurahList() {
    if (selectionContent.style.display === "inline") selectionContent.style.display = "none";
    else selectionContent.style.display = "inline";
}